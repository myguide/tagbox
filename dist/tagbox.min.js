var tagbox={inputName:"tags",preset:[],strict:!1,defaultTheme:!0,target:null,tagIndex:0,tagCount:0,inputElement:null,outputElement:null,searchResultsElement:null,tagSearchResults:[],searchTraverseIndex:null,selectedResult:null,inputStyle:{width:"100%",height:"24px",cssFloat:"left",border:"thin solid #c9c9c9",padding:"4px",paddingTop:"10px",outline:"0px solid transparent",color:"#444444",fontFamily:"Helvetica"},outputStyle:{width:"100%",cssFloat:"left",padding:"4px",border:"thin solid #c9c9c9",borderBottom:"none",display:"none"},tagStyle:{height:"18px",cssFloat:"left",margin:"3px",padding:"4px",border:"thin solid #cbd8f2",borderRadius:"5px",background:"#DEE7F7",color:"#444444",fontFamily:"Helvetica",fontWeight:"lighter",cursor:"pointer"},searchResultsStyle:{width:"100%",cssFloat:"left",border:"thin solid #c9c9c9",padding:"4px",borderTop:"none",display:"none"},resultStyle:{height:"18px",width:"98%",cssFloat:"left",marginBottom:"3px",marginTop:"3px",padding:"3px",color:"#444444",fontFamily:"Helvetica",fontWeight:"lighter",cursor:"pointer"},resultActiveStyle:{background:"#cbd8f2",borderRadius:"2px"},init:function(t,e){"undefined"!=typeof e&&this.applyOptions(e),this.target=document.getElementById(t),null!==this.target&&(this.createOutputArea(),this.createInputArea(),this.createSearchResultsArea())},applyOptions:function(t){for(var e in t)switch(e){case"tag":for(var s in t.tag)this.tagStyle[s]=t.tag[s];break;case"input":for(var a in t.input)this.inputStyle[a]=t.input[a];break;case"output":for(var i in t.output)this.outputStyle[i]=t.output[i];break;default:this[e]=t[e]}},applyStylesFromObject:function(t,e){if(this.defaultTheme===!0)for(var s in e)t.style[s]=e[s]},createOutputArea:function(){var t=document.createElement("div");t.id="tagbox-content-output",t.className="tagbox-output",this.applyStylesFromObject(t,this.outputStyle),this.outputElement=t,this.target.appendChild(this.outputElement)},createInputArea:function(){var t=document.createElement("div");t.id="tagbox-content-area",t.contentEditable=!0,t.addEventListener("keydown",function(t){tagbox.detectKeyPress(t)}),t.addEventListener("keyup",function(t){tagbox.searchPresets(),tagbox.displaySearchResults(t)}),t.className="tagbox-input",this.applyStylesFromObject(t,this.inputStyle),this.inputElement=t,this.target.appendChild(this.inputElement)},createSearchResultsArea:function(){var t=document.createElement("div");t.id="tagbox-search-results",t.className="tagbox-search-results",this.applyStylesFromObject(t,this.searchResultsStyle),this.searchResultsElement=t,this.target.appendChild(this.searchResultsElement)},detectKeyPress:function(t){(9==t.which||13==t.which||188==t.which)&&(t.preventDefault(),this.appendTag())},appendTag:function(){var t=this.inputElement.textContent;if(null!==this.selectedResult&&(t=this.selectedResult),this.strict===!0&&this.preset.indexOf(t)<0)return!1;if(this.validateTagContent(t)===!0){this.inputElement.textContent="",this.showOutputArea();var e=document.createElement("div");e.id="tagbox-tag-"+this.tagIndex,e.innerHTML=t.trim(),e.addEventListener("click",function(t){tagbox.removeTag(t)}),e.className="tagbox-tag",this.applyStylesFromObject(e,this.tagStyle),this.outputElement.appendChild(e),this.createHiddenInput(t),this.searchTraverseIndex=null,this.selectedResult=null}},validateTagContent:function(t){var e=t.trim();return""!==e?!0:!1},removeTag:function(t){var e=document.getElementById("tagbox-input-"+t.target.id.replace("tagbox-tag-",""));t.target.parentNode.removeChild(t.target),e.parentNode.removeChild(e),this.tagCount--,this.hideOutputArea()},showOutputArea:function(){this.outputElement.style.display="block"},hideOutputArea:function(){0===this.tagCount&&(this.outputElement.style.display="none")},createHiddenInput:function(t){var e=document.createElement("input");e.type="hidden",e.name=this.inputName+"["+this.tagIndex+"]",e.id="tagbox-input-"+this.tagIndex,e.value=t,this.target.appendChild(e),this.tagIndex++,this.tagCount++},searchPresets:function(){this.tagSearchResults=[];var t=this.inputElement.textContent,e=new RegExp("^"+t+".*");for(i=0;i<this.preset.length;i++)e.test(this.preset[i])&&this.tagSearchResults.push(this.preset[i]);""===t&&(this.tagSearchResults=[],this.searchResultsElement.style.display="none",this.searchTraverseIndex=null)},displaySearchResults:function(t){if(this.searchResultsElement.innerHTML="",this.tagSearchResults.length>0)for(var e in this.tagSearchResults){var s=document.createElement("div");s.textContent=this.tagSearchResults[e],s.id="tagbox-result-"+e,s.className="tagbox-result",s.addEventListener("click",function(t){tagbox.clickSearchResult(t)}),this.applyStylesFromObject(s,this.resultStyle),this.searchResultsElement.appendChild(s),this.searchResultsElement.style.display="block"}(40==t.which||38==t.which)&&(t.preventDefault(),this.traverseThroughResults(t.which))},traverseThroughResults:function(t){40==t&&(null===this.searchTraverseIndex?this.searchTraverseIndex=0:this.searchTraverseIndex<this.tagSearchResults.length-1&&this.searchTraverseIndex++),38==t&&null!==this.searchTraverseIndex&&this.searchTraverseIndex>=0&&(this.searchTraverseIndex--,-1==this.searchTraverseIndex&&(this.searchTraverseIndex=null)),this.highlightSearchResult()},highlightSearchResult:function(){var t=document.getElementById("tagbox-result-"+this.searchTraverseIndex);null!==t&&(t.className="tagbox-result tagbox-active",this.applyStylesFromObject(t,this.resultActiveStyle),this.selectedResult=t.textContent)},clickSearchResult:function(t){this.selectedResult=t.target.textContent,this.appendTag(),this.tagSearchResults=[],this.searchResultsElement.style.display="none",this.searchTraverseIndex=null}};